# About this PR

This is an automated pull request generated by the repository's `stubgen` utility.

It requires manual review and cleanup before it can be merged.

## Cleanup checklist

- [ ] Remove any modules that are not part of the main PyQGIS API.

  This includes:

  - `__init__.py`
  - `utils.py`
  - `testing/`
  - `user.py`

  The following modules must be kept for now and will be handled separately:

  - `core/additions/`

- [ ] Remove any monkey-patching wrapper modules.

  This includes:

  - `3d/`
  - `analysis/`
  - `gui/`
  - `server/`

  The following modules must be kept for now and will be handled separately:

  - `core/`
  - `core/additions/`
  - `processing/`

  You may also clear `core/__init__.py` at this stage, but keep the `from .additions.X import Y` lines for now.

- [ ] Rename the top-level modules to their canonical names. Note that `_qgis3d` must be named `_3d` as this is its name in QGIS.

  | Old name        | New name       |
  |-----------------|----------------|
  | `_analysis.pyi` | `analysis.pyi` |
  | `_core.pyi`     | `core.pyi`     |
  | `_gui.pyi`      | `gui.pyi`      |
  | `_qgis3d.pyi`   | `_3d.pyi`      |
  | `_server.pyi`   | `server.pyi`   |

  As part of this step, you must also update the imports accordingly. To keep edits small, it is recommended to use the following pattern:

  ```py
  from qgis import _core   ->   from . import _core as core
  ```

- [ ] Add missing type aliases. These names are not available at runtime, but do get used for argument and return value typing. Add additional ones as they get referenced:

  ```py
  QgsMultiPointXY = typing.List['QgsPointXY']
  QgsPolylineXY = typing.List['QgsPointXY']
  QgsPolygonXY = typing.List[QgsPolylineXY]
  QgsMultiPolygonXY = typing.List[QgsPolygonXY]
  QgsMultiPolylineXY = typing.List[QgsPolylineXY]
  QgsPointSequence = typing.List['QgsPoint']
  QgsPolyline = QgsPointSequence
  ```

  These must be part of `core.pyi` and cannot be moved to a separate `types.pyi` file as they rely on forward-references to the `QgsPoint` and `QgsPointXY` classes.

- [ ] Run the `convert-enums.py` script on the `qgis/` folder:

  ```sh
  python ./scripts/convert-enums.py qgis
  ```

- [ ] Search and replace the files in the `qgis/` folder using the following regular expression:

  Search:

  ```regex
  class (\w+)\('\w+\.(\w+)'\)
  ```

  Replace:

  ```regex
  class $1($2)
  ```

  This fixes malformed base class definitions like the following:

  ```py
  class NodeUnaryOperator('QgsSQLStatement.Node'):
  ```

- [ ] Some classes use `None` as a member.

  This is invalid in Python and must be commented out as users must use `getattr()` to work around this syntax limitation anyway, which obscures any type we could give it.

- [ ] `core.pyi` requires visibility of some `gui.pyi` widgets:

    ```py
    from .gui import (QgsCalloutWidget, QgsPaintEffectWidget, QgsRendererWidget,
                      QgsSymbolLayerWidget)
    ```

- [ ] `sip.voidptr` is not a real type and should be replaced with `typing.Any`

- [ ] Various occurrences of `typing.List` and `typing.Dict` have no type arguments

- [ ] Port the contents of `core.additions`.

  Not all names in this module are visible to the user or implemented. As a rule of thumb, only names that have search engine hits beyond the automatically generated QGIS stubs should be ported.

- [ ] Rename `core.pyi` to `core/__init__.pyi` and import any remaining names from `core.additions` into its namespace.

## Final review

At this stage, the stubs should be ready for manual testing and review. A recommended Pylance configuration can be found in `.vscode/settings.json`.
